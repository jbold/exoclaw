# HTTP Routes: Onboarding & Chat UI

**Feature**: `002-onboard-chat-ui`

## New Routes

### GET `/` — Leptos Chat Application

Serves the Leptos-rendered chat page. In SSR mode, returns pre-rendered HTML with a WASM hydration script.

**Response**: HTML document with inline Leptos app shell + `<script>` tag loading the WASM bundle from `/pkg/`.

**No authentication required** — the chat page itself is public. Auth happens at the WebSocket layer when the user sends their first message.

### GET `/pkg/*` — Static Assets (WASM bundle, JS glue)

Served by `tower_http::services::ServeDir` from the `target/site/pkg/` directory.

**Assets**:
- `*.wasm` — compiled Leptos frontend
- `*.js` — WASM glue code (generated by wasm-bindgen)
- `*.css` — styles (if separated)

**Cache headers**: `Cache-Control: public, max-age=31536000, immutable` (content-hashed filenames).

## Existing Routes (Unchanged)

### GET `/ws` — WebSocket JSON-RPC

No changes. The Leptos frontend connects to this endpoint using `gloo-net::WebSocket`. The JSON-RPC protocol is identical whether the client is the chat UI, `websocat`, or a custom client.

### GET `/health` — Health Check

No changes.

### POST `/webhook/{channel}` — Platform Webhooks

No changes.

## Route Registration Order

```rust
Router::new()
    // 1. Custom routes first (take precedence)
    .route("/ws", get(ws_handler))
    .route("/health", get(health))
    .route("/webhook/{channel}", post(webhook_handler))
    // 2. Leptos routes (catches / and renders the app)
    .leptos_routes(state, routes!(App))
    // 3. Static assets
    .fallback(ServeDir::new("target/site"))
```

## CLI Contract: `exoclaw onboard`

Not an HTTP route — a CLI subcommand.

```
exoclaw onboard [--provider <anthropic|openai>]
```

**Interactive prompts** (when `--provider` not given):
1. `Provider (anthropic/openai) [anthropic]:` — text input with default
2. `Anthropic API key:` — hidden input (rpassword)

**Exit codes**:
- `0` — success, config and credentials written
- `1` — validation error (empty key, invalid provider), filesystem error

**Stdout on success**:
```
exoclaw onboarding
This writes config to /home/user/.exoclaw/config.toml.
Saved config to /home/user/.exoclaw/config.toml
Saved API key to /home/user/.exoclaw/credentials/anthropic.key
Configured provider=anthropic model=claude-sonnet-4-5-20250929
Next: cargo run -- gateway
```
